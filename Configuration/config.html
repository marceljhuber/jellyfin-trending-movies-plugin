<!DOCTYPE html>
<html>
<head>
    <title>Trending Movies Banner Configuration</title>
</head>
<body>
    <div id="TrendingMoviesBannerConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="TrendingMoviesBannerConfigForm">
                    <div class="verticalSection">
                        <h2>TMDb Configuration</h2>
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="TmdbApiKey">TMDb API Key:</label>
                            <input is="emby-input" type="text" id="TmdbApiKey" name="TmdbApiKey" />
                            <div class="fieldDescription">
                                Get your free API key from <a href="https://www.themoviedb.org/settings/api" target="_blank">The Movie Database</a>
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h2>Display Settings</h2>
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="TopMoviesCount">Number of Trending Movies to Display:</label>
                            <input is="emby-input" type="number" id="TopMoviesCount" name="TopMoviesCount" min="5" max="20" />
                            <div class="fieldDescription">
                                How many trending movies to show in the banner (5-20)
                            </div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="RefreshIntervalHours">Refresh Interval (hours):</label>
                            <input is="emby-input" type="number" id="RefreshIntervalHours" name="RefreshIntervalHours" min="1" max="168" />
                            <div class="fieldDescription">
                                How often to refresh trending data from TMDb (1-168 hours)
                            </div>
                        </div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script type="text/javascript">
            var TrendingMoviesBannerConfig = {
                pluginUniqueId: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890',

                loadPage: function () {
                    Dashboard.showLoadingMsg();
                    ApiClient.getPluginConfiguration(TrendingMoviesBannerConfig.pluginUniqueId).then(function (config) {
                        document.querySelector('#TmdbApiKey').value = config.TmdbApiKey || '';
                        document.querySelector('#TopMoviesCount').value = config.TopMoviesCount || 10;
                        document.querySelector('#RefreshIntervalHours').value = config.RefreshIntervalHours || 24;
                        Dashboard.hideLoadingMsg();
                    });
                },

                submit: function () {
                    Dashboard.showLoadingMsg();
                    ApiClient.getPluginConfiguration(TrendingMoviesBannerConfig.pluginUniqueId).then(function (config) {
                        config.TmdbApiKey = document.querySelector('#TmdbApiKey').value;
                        config.TopMoviesCount = parseInt(document.querySelector('#TopMoviesCount').value);
                        config.RefreshIntervalHours = parseInt(document.querySelector('#RefreshIntervalHours').value);
                        
                        ApiClient.updatePluginConfiguration(TrendingMoviesBannerConfig.pluginUniqueId, config).then(function () {
                            Dashboard.processPluginConfigurationUpdateResult();
                        });
                    });
                    return false;
                }
            };

            document.querySelector('#TrendingMoviesBannerConfigForm').addEventListener('submit', TrendingMoviesBannerConfig.submit);
            
            window.addEventListener('load', function() {
                TrendingMoviesBannerConfig.loadPage();
            });
        </script>
    </div>
</body>
</html>
